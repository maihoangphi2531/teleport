local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local isTeleporting = false -- Biến khóa để đảm bảo các hoạt động khác dừng lại khi teleport

local specialPlayers = {"lkjh2531333", "lkjh2531222", "zczxc"} -- Danh sách các tên đặc biệt

local function getArgs()
    if LocalPlayer and table.find(specialPlayers, LocalPlayer.Name) then
        return { [1] = 39 }
    else
        return { [1] = 34 }
    end
end

local function teleportIfInSpecificLobby()
    stopAllScripts() -- Dừng trước khi bắt đầu teleport
    if isTeleporting then
        warn("Script đang dừng do teleport đang diễn ra.")
        return -- Dừng lại nếu đã có teleport đang thực hiện
    end

    isTeleporting = true -- Đặt khóa để dừng các hoạt động khác
    local args = getArgs()

    local success, err = pcall(function()
        if game.PlaceId == 2727067538 then
            warn("Teleporting from Main Menu to Hub 13")
            local placeId = 4310463616
            TeleportService:Teleport(placeId)
        elseif game.PlaceId == 4310463616 or game.PlaceId == 10651517727 then
            warn("Teleporting to Hub", args[1])
            local replicatedStorage = game:GetService("ReplicatedStorage")
            local teleportService = replicatedStorage:WaitForChild("Shared", 5):WaitForChild("Teleport", 5)
            local startRaidEvent = teleportService:WaitForChild("StartRaid", 5)
            if startRaidEvent then
                startRaidEvent:FireServer(unpack(args))
            end
        end
    end)

    if not success then
        warn("Error during teleport: " .. err)
    end

    wait(10)
    isTeleporting = false
end

local function runAfter7Minutes()
    stopAllScripts()
    wait(330)
    local args = getArgs()
    local replicatedStorage = game:GetService("ReplicatedStorage")
    local teleportService = replicatedStorage:WaitForChild("Shared"):WaitForChild("Teleport")
    local startRaidEvent = teleportService:WaitForChild("StartRaid")
    if startRaidEvent then
        startRaidEvent:FireServer(unpack(args))
    end
end

task.spawn(runAfter7Minutes)
